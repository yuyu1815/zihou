# Zihou – 時報ディスコードボット

Zihou は、あなたが今いるボイスチャンネル（VC）に参加し、毎正時にローカルの MP3 ファイルで時報を再生するシンプルな Discord ボットです。別の VC への自動移動は行いません。コマンドはハイブリッド（スラッシュ／プレフィックス）です。

- コマンド: `/start`, `/stop`
- 音声ファイル: `audio/1.mp3` ～ `audio/24.mp3`（0時は `24.mp3` を使用）
- FFmpeg がシステムの PATH で実行可能であることが必要

英語のドキュメントは `README.md` を参照してください。

## 特長
- `/start` で実行者の現在の VC に参加し、`/stop` まで滞在します。
- 毎正時に対応する時報ファイルを再生します。
  - ボットが未接続、またはすでに再生中のときはスキップします。
- 仕様として、別 VC への自動移動は行いません。

## 動作要件
- Python 3.11+（3.12 で動作確認）
- FFmpeg がインストールされ、コマンドラインから実行可能（`ffmpeg -version`）
- Discord ボットトークン

Python 依存関係は `requirements.txt`（`discord.py==2.6.3` など）に記載されています。

## セットアップ
1) プロジェクト直下に `audio` フォルダを作成し、以下のファイルを配置します。
   - `1.mp3` … `24.mp3`（0時は `24.mp3` を再生）
2) Discord のアプリケーション／ボットを作成し、以下の権限でサーバーに招待します。
   - 接続（Connect）、発言（Speak）※「メンバーを移動（Move Members）」は必須ではありません（自動移動しません）
3) 環境変数（`.env` またはシステム環境変数）を設定します。
   - `TOKEN`: ボットトークン
   - `PREFIX`（任意）: メッセージコマンドのプレフィックス（例: `!`）
   - `INVITE_LINK`（任意）: 埋め込みやメッセージで使用する招待リンク

依存関係をインストール:

```
python -m pip install -r requirements.txt
```

ボットを起動:

```
python bot.py
```

## 使い方
- 参加させたい VC にあなたが入った状態で `/start`（もしくは `start`）を実行します。ボットは参加し、次の正時から時報を再生します。
- `/stop` で退出します。
- 同一ギルドの別 VC にすでに接続している場合でも、ボットは移動しません。目的の VC に入れてほしい場合は一度 `/stop` で切断し、目的の VC で `/start` を実行してください。

## Docker
`docker-compose.yml` を同梱しています。Docker をインストール後、次のコマンドで起動できます。

```
docker compose up -d --build
```

注意:
- MP3 をイメージ外に置く場合は、コンテナへ `audio` フォルダをマウントしてください。
- 環境変数は `.env` もしくは Compose の `env_file` / `environment` で渡してください。
- Dockerfile をカスタマイズする場合、イメージ内で FFmpeg が利用可能であることを確認してください。

## トラブルシューティング
- 「FFmpeg 初期化に失敗」: FFmpeg のインストールと PATH 設定を確認し、`ffmpeg -version` が実行できるか確認してください。
- 「音声ファイルが見つからない」: `audio/1.mp3 … 24.mp3` が存在するか、およびボットの作業ディレクトリがプロジェクト直下かを確認してください。
- 「ボットが参加しない」: 対象 VC でボットに Connect / Speak 権限があるか確認してください。
- 「時報が鳴らない」: 毎正時のみ再生します。すでに再生中の場合はその時間をスキップします。

## 謝辞
本プロジェクトは `kkrypt0nn/Python-Discord-Bot-Template` をベースに、時報用途に合わせて最小限に調整しています。

## ライセンス
Apache License 2.0 — [`LICENSE.md`](LICENSE.md) を参照してください。
